<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Wave Dash - INSANE MODE</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; left: 20px; color: #0f0; pointer-events: none; }
        #msg { font-weight: bold; font-size: 1.2em; color: #fff; }
    </style>
</head>
<body>
    <div id="ui">
        <h1>WAVE DASH: INSANE</h1>
        <p id="score">Pontos: 0</p>
        <p id="msg">CLIQUE PARA INICIAR O JOGO!</p>
    </div>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreElement = document.getElementById('score');
const msgElement = document.getElementById('msg');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0;
let gameActive = false;

// VELOCIDADE 3X MAIS RÁPIDA
let speed = 21; 
const gravity = 1.8; // Gravidade aumentada para compensar a velocidade
const lift = -2.2;

// Sistema de Áudio por URL
const bgMusic = new Audio('Sonic Wave.mp3');
bgMusic.loop = true;

class Player {
    constructor(x, color) {
        this.x = x;
        this.y = canvas.height / 2;
        this.vy = 0;
        this.color = color;
        this.isUp = false;
        this.alive = true;
        this.history = [];
    }

    update() {
        if (!this.alive) return;
        this.vy += this.isUp ? lift : gravity;
        // Limite de velocidade vertical maior para a velocidade 3x
        this.vy = Math.max(Math.min(this.vy, 20), -20);
        this.y += this.vy;

        if (this.y < 0 || this.y > canvas.height) this.alive = false;

        this.history.push({x: this.x, y: this.y});
        // Rastro mais longo para efeito visual
        if (this.history.length > 50) this.history.shift();
    }

    draw() {
        ctx.beginPath();
        ctx.strokeStyle = this.color;
        ctx.lineWidth = 5;
        ctx.shadowBlur = 10;
        ctx.shadowColor = this.color;
        for(let i = 0; i < this.history.length; i++) {
            ctx.lineTo(this.history[i].x - (this.history.length - i) * speed, this.history[i].y);
        }
        ctx.stroke();
        ctx.shadowBlur = 0;

        ctx.fillStyle = "#fff";
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x - 30, this.y - 15);
        ctx.lineTo(this.x - 30, this.y + 15);
        ctx.fill();
    }
}

class Obstacle {
    constructor() {
        this.w = 80;
        this.h = 40 + Math.random() * (canvas.height / 3);
        this.x = canvas.width;
        this.type = Math.random() > 0.5 ? 'top' : 'bottom';
        this.y = this.type === 'top' ? 0 : canvas.height - this.h;
    }
    update() { this.x -= speed; }
    draw() {
        ctx.fillStyle = "#ff00ff";
        ctx.shadowBlur = 20;
        ctx.shadowColor = "#ff00ff";
        ctx.fillRect(this.x, this.y, this.w, this.h);
        ctx.shadowBlur = 0;
    }
}

let p1 = new Player(400, "#0f0");
let obstacles = [];

function startGame() {
    if(!gameActive) {
        gameActive = true;
        msgElement.innerText = "";
        bgMusic.play();
    }
}

window.addEventListener('keydown', (e) => { 
    if(e.code === 'Space' || e.key === 'w') {
        startGame();
        p1.isUp = true;
    }
});
window.addEventListener('keyup', (e) => { 
    if(e.code === 'Space' || e.key === 'w') p1.isUp = false; 
});
canvas.addEventListener('mousedown', () => { 
    startGame();
    p1.isUp = true; 
});
canvas.addEventListener('mouseup', () => { p1.isUp = false; });

function loop() {
    // Efeito de fundo "Glow"
    ctx.fillStyle = "rgba(0, 0, 0, 0.2)"; 
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if (gameActive && p1.alive) {
        score += 2; // Score sobe mais rápido no modo insane
        scoreElement.innerText = `PONTOS: ${Math.floor(score/10)}`;
        
        // Spawn de obstáculos ajustado para a velocidade 3x
        if (score % 60 === 0) obstacles.push(new Obstacle());

        p1.update();
        p1.draw();

        for (let i = obstacles.length - 1; i >= 0; i--) {
            obstacles[i].update();
            obstacles[i].draw();
            
            // Colisão
            if (p1.x > obstacles[i].x && 
                p1.x - 25 < obstacles[i].x + obstacles[i].w &&
                p1.y + 10 > obstacles[i].y && 
                p1.y - 10 < obstacles[i].y + obstacles[i].h) {
                p1.alive = false;
                bgMusic.pause();
            }
            if (obstacles[i].x < -200) obstacles.splice(i, 1);
        }
    } else if (gameActive && !p1.alive) {
        ctx.fillStyle = "red";
        ctx.textAlign = "center";
        ctx.font = "bold 50px Courier New";
        ctx.fillText("CRITICAL FAILURE", canvas.width/2, canvas.height/2);
        ctx.font = "20px Courier New";
        ctx.fillStyle = "white";
        ctx.fillText("CLIQUE PARA REINICIAR", canvas.width/2, canvas.height/2 + 50);
        canvas.onclick = () => location.reload();
    }

    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>